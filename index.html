<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>TSE</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg: #0b0e14;
  --panel: #121826;
  --border: #1f2a44;
  --accent: #6d7cff;
  --text: #e6e9f2;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  background: radial-gradient(1200px 600px at 50% -200px, #1a2140, var(--bg));
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

header {
  padding: 16px 24px;
  font-weight: 700;
  letter-spacing: .5px;
}

.tabs {
  display: flex;
  gap: 10px;
  padding: 0 24px;
}

.tab {
  padding: 8px 14px;
  border-radius: 999px;
  background: #161d34;
  cursor: pointer;
  opacity: .7;
}
.tab.active { background: var(--accent); opacity: 1; }

main { padding: 24px; }

.panel {
  background: linear-gradient(180deg, #141a30, #0e1324);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 20px;
}

.hidden { display: none; }

video {
  width: 100%;
  background: black;
  border-radius: 12px;
}

/* NOTES */
.toolbar {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
}
.toolbar button, .toolbar select, .toolbar input {
  background: #1a2140;
  color: white;
  border: 1px solid #2a3470;
  border-radius: 6px;
  padding: 6px 8px;
}
#editor {
  min-height: 240px;
  padding: 12px;
  background: #0a0f1f;
  border: 1px solid #2a3470;
  border-radius: 10px;
  outline: none;
}
#editor img {
  max-width: 100%;
  resize: both;
  overflow: auto;
  border: 1px dashed #555;
}

/* NEWS */
iframe {
  width: 100%;
  height: 70vh;
  border: none;
  border-radius: 12px;
}
</style>
</head>

<body>

<header>TSE</header>

<div class="tabs">
  <div class="tab active" data-tab="videos">Videos</div>
  <div class="tab" data-tab="notes">Notes</div>
  <div class="tab" data-tab="bible">Daily Bible Study</div>
  <div class="tab" data-tab="news">News</div>
</div>

<main>

<!-- VIDEOS -->
<div id="videos" class="panel">
  <h3>Video Player</h3>
  <video id="player" controls></video>
  <button id="loadDemo">Load demo video</button>
</div>

<!-- NOTES -->
<div id="notes" class="panel hidden">
  <h3>Notes</h3>

  <div class="toolbar">
    <button data-style="bold">B</button>
    <button data-style="italic">I</button>
    <button data-style="underline">U</button>
    <input type="color" id="colorPicker" />
    <select id="fontSize">
      <option value="14px">14</option>
      <option value="16px">16</option>
      <option value="20px">20</option>
      <option value="28px">28</option>
    </select>
    <input type="file" id="imgUpload" accept="image/*" />
  </div>

  <div id="editor" contenteditable="true">
    Start writing notes…
  </div>
</div>

<!-- BIBLE -->
<div id="bible" class="panel hidden">
  <h3>Daily Bible Study</h3>

  <input id="verseInput" placeholder="John 3:16" />
  <button id="loadVerse">Generate Lesson</button>

  <div id="bibleContent"></div>
</div>

<!-- NEWS -->
<div id="news" class="panel hidden">
  <h3>Market News</h3>

  <select id="newsSelect">
    <option value="">Select source</option>
    <option value="https://www.forexfactory.com">Forex Factory</option>
    <option value="https://www.investing.com">Investing.com</option>
    <option value="https://www.marketwatch.com">MarketWatch</option>
    <option value="https://www.bloomberg.com/markets">Bloomberg Markets</option>
  </select>

  <iframe id="newsFrame"></iframe>
</div>

</main>

<script>
/* ---------- GLOBAL SAFETY ---------- */
window.onerror = (msg) => {
  console.error("JS error prevented crash:", msg);
};

/* ---------- TABS ---------- */
document.querySelectorAll(".tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".panel").forEach(p => p.classList.add("hidden"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.remove("hidden");
  };
});

/* ---------- VIDEO ---------- */
const player = document.getElementById("player");
document.getElementById("loadDemo").onclick = () => {
  try {
    player.pause();
    player.removeAttribute("src");
    player.load();
    player.src = "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4";
  } catch {}
};

/* ---------- NOTES (NO execCommand) ---------- */
function applyStyle(style, value) {
  const sel = window.getSelection();
  if (!sel.rangeCount) return;
  const range = sel.getRangeAt(0);
  if (range.collapsed) return;
  const span = document.createElement("span");
  span.style[style] = value;
  range.surroundContents(span);
}

document.querySelectorAll("[data-style]").forEach(btn => {
  btn.onclick = () => {
    const map = {
      bold: ["fontWeight", "700"],
      italic: ["fontStyle", "italic"],
      underline: ["textDecoration", "underline"]
    };
    applyStyle(...map[btn.dataset.style]);
  };
});

document.getElementById("colorPicker").oninput =
  e => applyStyle("color", e.target.value);
document.getElementById("fontSize").onchange =
  e => applyStyle("fontSize", e.target.value);

document.getElementById("imgUpload").onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const img = document.createElement("img");
  img.src = URL.createObjectURL(file);
  document.getElementById("editor").appendChild(img);
};

/* ---------- BIBLE API ---------- */
document.getElementById("loadVerse").onclick = async () => {
  const ref = document.getElementById("verseInput").value || "John 3:16";
  const out = document.getElementById("bibleContent");
  out.innerHTML = "Loading…";

  try {
    const res = await fetch(`https://bible-api.com/${encodeURIComponent(ref)}`);
    const data = await res.json();
    out.innerHTML = `
      <h4>${data.reference}</h4>
      <p>${data.text}</p>
      <hr/>
      <b>Observe:</b> What does this reveal about God?<br/>
      <b>Interpret:</b> What does it mean?<br/>
      <b>Apply:</b> How should this change you?<br/>
      <b>Prayer:</b> Write a short prayer.
    `;
  } catch {
    out.textContent = "Failed to load verse.";
  }
};

/* ---------- NEWS ---------- */
document.getElementById("newsSelect").onchange = e => {
  document.getElementById("newsFrame").src = e.target.value;
};
</script>

</body>
</html>
